{"ast":null,"code":"'use strict';\n\nconst promiseOrCallback = require('../promiseOrCallback');\nconst {\n  queryMiddlewareFunctions,\n  aggregateMiddlewareFunctions,\n  modelMiddlewareFunctions,\n  documentMiddlewareFunctions\n} = require('../../constants');\nconst middlewareFunctions = Array.from(new Set([...queryMiddlewareFunctions, ...aggregateMiddlewareFunctions, ...modelMiddlewareFunctions, ...documentMiddlewareFunctions]));\nmodule.exports = function applyStaticHooks(model, hooks, statics) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1\n  };\n  model.$__insertMany = hooks.createWrapper('insertMany', model.$__insertMany, model, kareemOptions);\n  hooks = hooks.filter(hook => {\n    // If the custom static overwrites an existing middleware, don't apply\n    // middleware to it by default. This avoids a potential backwards breaking\n    // change with plugins like `mongoose-delete` that use statics to overwrite\n    // built-in Mongoose functions.\n    if (middlewareFunctions.indexOf(hook.name) !== -1) {\n      return !!hook.model;\n    }\n    return hook.model !== false;\n  });\n  for (const key of Object.keys(statics)) {\n    if (hooks.hasHooks(key)) {\n      const original = model[key];\n      model[key] = function () {\n        const numArgs = arguments.length;\n        const lastArg = numArgs > 0 ? arguments[numArgs - 1] : null;\n        const cb = typeof lastArg === 'function' ? lastArg : null;\n        const args = Array.prototype.slice.call(arguments, 0, cb == null ? numArgs : numArgs - 1);\n        // Special case: can't use `Kareem#wrap()` because it doesn't currently\n        // support wrapped functions that return a promise.\n        return promiseOrCallback(cb, callback => {\n          hooks.execPre(key, model, args, function (err) {\n            if (err != null) {\n              return callback(err);\n            }\n            let postCalled = 0;\n            const ret = original.apply(model, args.concat(post));\n            if (ret != null && typeof ret.then === 'function') {\n              ret.then(res => post(null, res), err => post(err));\n            }\n            function post(error, res) {\n              if (postCalled++ > 0) {\n                return;\n              }\n              if (error != null) {\n                return callback(error);\n              }\n              hooks.execPost(key, model, [res], function (error) {\n                if (error != null) {\n                  return callback(error);\n                }\n                callback(null, res);\n              });\n            }\n          });\n        }, model.events);\n      };\n    }\n  }\n};","map":{"version":3,"names":["promiseOrCallback","require","queryMiddlewareFunctions","aggregateMiddlewareFunctions","modelMiddlewareFunctions","documentMiddlewareFunctions","middlewareFunctions","Array","from","Set","module","exports","applyStaticHooks","model","hooks","statics","kareemOptions","useErrorHandlers","numCallbackParams","$__insertMany","createWrapper","filter","hook","indexOf","name","key","Object","keys","hasHooks","original","numArgs","arguments","length","lastArg","cb","args","prototype","slice","call","callback","execPre","err","postCalled","ret","apply","concat","post","then","res","error","execPost","events"],"sources":["C:/Users/wliu6/OneDrive/Desktop/Web Development/we-detox/Anon-Connect/anon-connect/node_modules/mongoose/lib/helpers/model/applyStaticHooks.js"],"sourcesContent":["'use strict';\n\nconst promiseOrCallback = require('../promiseOrCallback');\nconst { queryMiddlewareFunctions, aggregateMiddlewareFunctions, modelMiddlewareFunctions, documentMiddlewareFunctions } = require('../../constants');\n\nconst middlewareFunctions = Array.from(\n  new Set([\n    ...queryMiddlewareFunctions,\n    ...aggregateMiddlewareFunctions,\n    ...modelMiddlewareFunctions,\n    ...documentMiddlewareFunctions\n  ])\n);\n\nmodule.exports = function applyStaticHooks(model, hooks, statics) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1\n  };\n\n  model.$__insertMany = hooks.createWrapper('insertMany',\n    model.$__insertMany, model, kareemOptions);\n\n  hooks = hooks.filter(hook => {\n    // If the custom static overwrites an existing middleware, don't apply\n    // middleware to it by default. This avoids a potential backwards breaking\n    // change with plugins like `mongoose-delete` that use statics to overwrite\n    // built-in Mongoose functions.\n    if (middlewareFunctions.indexOf(hook.name) !== -1) {\n      return !!hook.model;\n    }\n    return hook.model !== false;\n  });\n\n  for (const key of Object.keys(statics)) {\n    if (hooks.hasHooks(key)) {\n      const original = model[key];\n\n      model[key] = function() {\n        const numArgs = arguments.length;\n        const lastArg = numArgs > 0 ? arguments[numArgs - 1] : null;\n        const cb = typeof lastArg === 'function' ? lastArg : null;\n        const args = Array.prototype.slice.\n          call(arguments, 0, cb == null ? numArgs : numArgs - 1);\n        // Special case: can't use `Kareem#wrap()` because it doesn't currently\n        // support wrapped functions that return a promise.\n        return promiseOrCallback(cb, callback => {\n          hooks.execPre(key, model, args, function(err) {\n            if (err != null) {\n              return callback(err);\n            }\n\n            let postCalled = 0;\n            const ret = original.apply(model, args.concat(post));\n            if (ret != null && typeof ret.then === 'function') {\n              ret.then(res => post(null, res), err => post(err));\n            }\n\n            function post(error, res) {\n              if (postCalled++ > 0) {\n                return;\n              }\n\n              if (error != null) {\n                return callback(error);\n              }\n\n              hooks.execPost(key, model, [res], function(error) {\n                if (error != null) {\n                  return callback(error);\n                }\n                callback(null, res);\n              });\n            }\n          });\n        }, model.events);\n      };\n    }\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}